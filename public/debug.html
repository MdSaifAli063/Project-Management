<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Auth Debug Helper</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      max-width: 600px;
      width: 100%;
      padding: 40px;
    }
    h1 {
      color: #333;
      margin-bottom: 30px;
      text-align: center;
    }
    .section {
      margin-bottom: 30px;
      padding: 20px;
      background: #f9f9f9;
      border-radius: 8px;
      border-left: 4px solid #667eea;
    }
    .section h2 {
      color: #667eea;
      font-size: 16px;
      margin-bottom: 15px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .info-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid #e0e0e0;
    }
    .info-item:last-child {
      border-bottom: none;
    }
    .info-item label {
      color: #666;
      font-weight: 500;
    }
    .info-item value {
      color: #333;
      font-family: monospace;
      font-size: 12px;
      word-break: break-all;
      max-width: 250px;
    }
    .status {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
    }
    .status.ok { background: #d4edda; color: #155724; }
    .status.error { background: #f8d7da; color: #721c24; }
    .button-group {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    button {
      flex: 1;
      padding: 12px 20px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
    }
    .btn-primary {
      background: #667eea;
      color: white;
    }
    .btn-primary:hover {
      background: #5568d3;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }
    .btn-secondary {
      background: #f0f0f0;
      color: #333;
      border: 1px solid #ddd;
    }
    .btn-secondary:hover {
      background: #e8e8e8;
    }
    .console-output {
      background: #1e1e1e;
      color: #d4d4d4;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      padding: 12px;
      border-radius: 6px;
      max-height: 200px;
      overflow-y: auto;
      margin-top: 10px;
    }
    .console-output.empty {
      color: #666;
    }
    .console-line {
      margin: 4px 0;
    }
    .console-line.error { color: #f48771; }
    .console-line.success { color: #89d185; }
    .console-line.warn { color: #dcdcaa; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîê Authentication Debug</h1>

    <div class="section">
      <h2>üìç Browser State</h2>
      <div class="info-item">
        <label>localStorage Enabled:</label>
        <span class="status" id="localStorage-status">checking...</span>
      </div>
      <div class="info-item">
        <label>JavaScript Enabled:</label>
        <span class="status" id="js-status">OK</span>
      </div>
      <div class="info-item">
        <label>Server Reachable:</label>
        <span class="status" id="server-status">checking...</span>
      </div>
    </div>

    <div class="section">
      <h2>üîë localStorage Content</h2>
      <div class="info-item">
        <label>pc_access Token:</label>
        <value id="token-display">none</value>
      </div>
      <div class="info-item">
        <label>pc_user Object:</label>
        <value id="user-display">none</value>
      </div>
    </div>

    <div class="section">
      <h2>üß™ Actions</h2>
      <div class="button-group">
        <button class="btn-primary" onclick="testLogin()">Login Test</button>
        <button class="btn-secondary" onclick="clearStorage()">Clear Storage</button>
      </div>
      <div class="button-group">
        <button class="btn-secondary" onclick="toDashboard()">Go to Dashboard</button>
        <button class="btn-secondary" onclick="location.reload()">Refresh Page</button>
      </div>
    </div>

    <div class="section">
      <h2>üìù Console</h2>
      <div class="console-output" id="console">
        <div class="console-line">Initializing...</div>
      </div>
    </div>
  </div>

  <script>
    const consoleEl = document.getElementById('console');
    const logs = [];

    function log(msg, type = 'info') {
      const line = document.createElement('div');
      line.className = `console-line ${type}`;
      const timestamp = new Date().toLocaleTimeString();
      line.textContent = `[${timestamp}] ${msg}`;
      consoleEl.appendChild(line);
      consoleEl.scrollTop = consoleEl.scrollHeight;
      logs.push(`[${timestamp}] ${msg}`);
    }

    // Check localStorage
    try {
      localStorage.setItem('_test', '1');
      localStorage.removeItem('_test');
      document.getElementById('localStorage-status').className = 'status ok';
      document.getElementById('localStorage-status').textContent = '‚úì Enabled';
      log('localStorage is enabled', 'success');
    } catch (e) {
      document.getElementById('localStorage-status').className = 'status error';
      document.getElementById('localStorage-status').textContent = '‚úó Disabled!';
      log('ERROR: localStorage is disabled!', 'error');
    }

    // Check server
    fetch('http://localhost:5000/api/v1/healthcheck', { mode: 'no-cors' })
      .then(() => {
        document.getElementById('server-status').className = 'status ok';
        document.getElementById('server-status').textContent = '‚úì Running';
        log('Server is reachable at localhost:5000', 'success');
      })
      .catch(() => {
        document.getElementById('server-status').className = 'status error';
        document.getElementById('server-status').textContent = '‚úó Not found';
        log('ERROR: Server not reachable at localhost:5000', 'error');
      });

    // Display current storage
    function updateDisplay() {
      const token = localStorage.getItem('pc_access');
      const user = localStorage.getItem('pc_user');
      
      document.getElementById('token-display').textContent = token
        ? token.substring(0, 50) + '...'
        : 'Not set';
      
      document.getElementById('user-display').textContent = user || 'Not set';
    }

    updateDisplay();
    log('Page loaded');

    // Test login
    async function testLogin() {
      log('Starting login test...', 'warn');
      
      const email = prompt('Email:', 'admin@test.com');
      const password = prompt('Password:', '123456');
      
      if (!email || !password) {
        log('Login cancelled', 'warn');
        return;
      }

      try {
        const res = await fetch('http://localhost:5000/api/v1/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include',
          body: JSON.stringify({ email, password })
        });

        const data = await res.json();

        if (res.ok && data.accessToken) {
          localStorage.setItem('pc_access', data.accessToken);
          localStorage.setItem('pc_user', JSON.stringify(data.user));
          updateDisplay();
          log(`Login successful! User: ${data.user.name}`, 'success');
        } else {
          log(`Login failed: ${data.message}`, 'error');
        }
      } catch (e) {
        log(`Error: ${e.message}`, 'error');
      }
    }

    function clearStorage() {
      if (confirm('Clear all stored data?')) {
        localStorage.clear();
        updateDisplay();
        log('localStorage cleared', 'warn');
      }
    }

    function toDashboard() {
      window.location.href = '/dashboard.html';
    }

    log('Debug page ready!', 'success');
  </script>
</body>
</html>
